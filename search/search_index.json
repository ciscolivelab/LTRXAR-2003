{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#ltrxar-2003","title":"LTRXAR - 2003","text":"<p>Welcome to Cisco Live LTRXAR-2003 - SD-WAN Multi-Region Fabric(MRF) Migration Lab</p> <p>For full documentation visit Cisco Live.</p>"},{"location":"#speakers","title":"Speakers","text":"<ul> <li>Lei Tian <code>Customer Delivery Architect, Cisco CX</code></li> <li>Oscar Eduardo Desentis Clemente <code>Customer Delivery Architect, Cisco CX</code> </li> <li>this another speaker :)</li> </ul>"},{"location":"about/","title":"About The Lab","text":""},{"location":"about/#multi-region-fabric-mrf-overview","title":"Multi-Region Fabric (MRF) Overview","text":"<p>The current Catalyst SDWAN architecture follows a flat overlay model, establishing site-to-site tunnels directly between sites. While this flat overlay model functions adequately in many scenarios, it does have its limitations:  </p> <ul> <li>Centralized control policy is necessary for Hub and Spoke topology or setting route preferences. Depending on the specific requirements of the topology, this policy can become quite complex.  </li> <li>Integrating transports from disparate providers for the underlay can be challenging. This is particularly relevant when attempting to leverage middle mile providers or cloud backbone providers' networks for inter-region traffic.  </li> <li>Large enterprises and managed service providers (MSPs) often require SDWAN to extend across multiple regions.  </li> </ul> <p>Now, with Multi-Region Fabric (MRF), it offers following enhancements  </p> <ul> <li>Foundational capability that underpins our journey to multi-cloud and SDCI  <ul> <li>Ensure market-leading scalability  </li> <li>Service enablement at gateway points</li> <li>Increase network resiliency  </li> </ul> </li> <li>Improve OMP to support a true scalable Multi-Region Fabric SD-WAN  </li> <li>3-level customer overlay  <ul> <li>Introduces Regions  </li> <li>Primary Access Region  </li> <li>Secondary Region  </li> <li>Subregion  </li> <li>Border routers provide tunnel stitching  </li> <li>Inter Regions always goes via border routers  </li> </ul> </li> <li>End to end SLA aware path computation  </li> <li>Simplifies user-visible configuration  </li> </ul>"},{"location":"about/#about-this-lab","title":"About This Lab","text":"<p>This lab has been designed to showcase a comprehensive array of MRF features provided by the Cisco SD-WAN solution in a systematic manner. While a predefined topology is outlined and associated with each scenario, the lab instructions can also be tailored to the specific requirements of attendees. Participants can utilize the steps outlined in this lab to transition their flat fabric into an MRF.  </p> <p>Upon completing this lab, you will:  </p> <ul> <li>Gain insight into the intricacies of using the legacy approach to create and deploy hierarchical topologies within a flat Catalyst SD-WAN Fabric.  </li> <li>Successfully migrate from a flat Catalyst SD-WAN fabric to an MRF fabric with minimal disruption.  </li> <li>Understand the streamlined process for deploying a hierarchical topology using MRF fabric.  </li> <li>Understand and deploy MRF features such as 2nd region, transit gateway and MRF policy.  </li> </ul>"},{"location":"access/","title":"Lab Crendential","text":"<p>Below table provides the IP addresses and credentials for the devices used in this lab:  </p> <ul> <li>UI Connection Details  </li> </ul> Node IP:Port Username Password Manager https://vmanage.dcloud.cisco.com:8443 admin C1sco12345 <ul> <li>SD-WAN Controllers  </li> </ul> Hostname System IP Site ID Username Password Manager-1 1.1.1.1 1 admin C1sco12345 Validator-1 1.1.1.2 1 admin C1sco12345 Controller-1 1.1.1.3 1 admin C1sco12345 Controller-2 1.1.1.4 1 admin C1sco12345 Controller-3 1.1.1.5 1 admin C1sco12345 Controller-4 1.1.1.6 1 admin C1sco12345 <ul> <li>SD-WAN Edges </li> </ul> Hostname System IP Site ID Username Password BR-WEST-1 1.1.201.1 201 admin C1sco12345 BR-WEST-2 1.1.201.2 201 admin C1sco12345 BR-EAST-1 1.1.202.1 202 admin C1sco12345 BR-EAST-2 1.1.202.2 202 admin C1sco12345 EDGE-HUB-1-01 1.1.10.1 1010 admin C1sco12345 EDGE-HUB-1-02 1.1.10.2 1010 admin C1sco12345 EDGE-HUB-2-01 1.1.20.1 1020 admin C1sco12345 EDGE-HUB-2-02 1.1.20.2 1020 admin C1sco12345 EDGE-BRANCH-3-01 1.1.30.1 3000 admin C1sco12345 EDGE-BRANCH-4-01 1.1.40.1 4000 admin C1sco12345 EDGE-BRANCH-4-02 1.1.40.2 4000 admin C1sco12345 EDGE-BRANCH-5-01 1.1.50.1 5000 admin C1sco12345 EDGE-BRANCH-6-01 1.1.60.1 6000 admin C1sco12345 EDGE-BRANCH-7-01 1.1.70.1 7000 admin C1sco12345 <ul> <li>SD-WAN Edges - Interfaces  </li> </ul> Hostname Pub-Inet TLOC If Pub-Inet IP Address MPLS TLOC If MPLS IP Address Private1 TLOC If Private1 IP Address Private2 TLOC If Private2 IP Address BR-WEST-1 Gi2 124.124.124.2/24 Gi1 10.2.1.2/24 Gi3 172.16.1.1/24 Gi4 172.16.2.1/24 BR-WEST-2 Gi2 125.125.125.2/24 Gi1 10.2.2.2/24 Gi3 172.16.1.2/24 Gi4 172.16.2.2/24 BR-EAST-1 Gi2 131.131.131/2/24 Gi1 10.2.3.1/24 Gi3 172.16.1.3/24 Gi4 172.16.2.3/24 BR-EAST-2 Gi2 132.132.132.2/24 Gi1 10.2.4.1/24 Gi3 172.16.1.4/24 Gi4 172.16.2.4/24 Hostname Pub-Inet TLOC If Pub-Inet IP Address MPLS TLOC If MPLS IP Address SVPN 10 If SVPN 10 IP Address SVPN 11 If SVPN 11 IP Address EDGE-DC-1-01 Gi1 126.126.126.2/24 Gi2 10.2.5.1/24 Gi3 10.10.1.1/24 Gi4 10.11.1.1/24 EDGE-DC-1-02 Gi1 128.128.128.2/24 Gi2 10.2.6.2/24 Gi3 10.10.1.2/24 Gi4 10.11.1.2/24 EDGE-DC-2-01 Gi1 129.129.129.2/24 Gi2 10.2.7.2/24 Gi3 10.20.1.1/24 Gi4 10.21.1.1/24 EDGE-DC-2-02 Gi1 130.130.130.2/24 Gi2 10.2.8.2/24 Gi3 10.20.1.2/24 Gi4 10.21.1.2/24 EDGE-BRANCH-3-01 Gi1 133.133.133.2/24 Gi2 10.2.9.2/24 Gi3 10.30.1.1/24 Gi4 10.31.1.1/24 EDGE-BRANCH-4-01 Gi1 144.144.144.2/24 Gi2 10.2.10.130/25 Gi3 10.40.1.1/24 Gi4 10.41.1.1/24 EDGE-BRANCH-4-02 Gi1 192.168.0.2/24 Gi2 10.2.10.2/25 Gi3 10.40.1.2/24 Gi4 10.41.1.2/24 EDGE-BRANCH-5-01 Gi1 145.145.145.2/24 Gi2 10.2.11.2/24 Gi3 10.50.1.129/25 Gi4 10.51.1.129/25 EDGE-BRANCH-6-01 Gi1 146.146.146.2/24 N/A N/A Gi2 10.60.1.1/24 Gi3 10.61.1.1/24 EDGE-BRANCH-7-01 N/A N/A Gi1 10.2.12.2/24 Gi2 10.70.1.129/25 Gi3 10.71.1.129/25"},{"location":"login/","title":"Pod Login","text":"<p>You will initiate VPN connection to the network setup used in this lab.  All the devices in this lab are running as Virtual Instances.  At the end of this task, you will have VPN connection to this remote setup</p>"},{"location":"login/#step-1-connect-to-lab-using-anyconnect-vpn","title":"Step 1: Connect to lab using anyconnect VPN","text":"<p>You will connect to Anyconnect url using Cisco VPN AnyConnect client and with the username &amp; password as documented in below table.  Below screenshot shows an example of that VPN connection.</p> Pod ID Attendee Name Anyconnect url Anyconnect Username Anyconnect Password POD  1 dcloud-lon-anyconnect.cisco.com POD  2 dcloud-lon-anyconnect.cisco.com POD  3 dcloud-lon-anyconnect.cisco.com POD  4 dcloud-lon-anyconnect.cisco.com POD  5 dcloud-lon-anyconnect.cisco.com POD  6 dcloud-lon-anyconnect.cisco.com POD  7 dcloud-lon-anyconnect.cisco.com POD  8 dcloud-lon-anyconnect.cisco.com POD  9 dcloud-lon-anyconnect.cisco.com POD  10 dcloud-lon-anyconnect.cisco.com POD  11 dcloud-lon-anyconnect.cisco.com POD  12 dcloud-lon-anyconnect.cisco.com POD  13 dcloud-lon-anyconnect.cisco.com POD  14 dcloud-lon-anyconnect.cisco.com POD  15 dcloud-lon-anyconnect.cisco.com POD  16 dcloud-lon-anyconnect.cisco.com POD  17 dcloud-lon-anyconnect.cisco.com POD  18 dcloud-lon-anyconnect.cisco.com <p>Note</p> <p>lab admin will furnish the credentials information to the participant.  If you don't have this information please ask the lab speakers.</p> <p></p>"},{"location":"login/#step-2-enter-vpn-credentials","title":"Step 2: Enter VPN credentials","text":"<p>After prompted for credentials, use the credentials documented in above table or provided by the lab admin.</p> <ul> <li>Below is an example of user logging into a reference POD:</li> </ul> <p></p> <ul> <li>Hit accept when the prompt appears to accept the VPN connection login</li> </ul> <p></p>"},{"location":"login/#step-3-rdp-to-workstation","title":"Step 3: RDP to workstation","text":"<p>In this step, you will connect to the workstation with Remote Desktop (RDP) client on your machines.  Use below details for this RDP session:</p> <ul> <li>Workstation: 198.18.133.36</li> <li>Username: admin</li> <li>Password: C1sco12345</li> </ul> <p>Below screenshot is only an example for this RDP connection:</p> <p></p>"},{"location":"task1/","title":"Task 1 - Explore Flat Fabric Policy","text":"<p>In this task you will understand the current active centralized policy that creates a Regional Hub &amp; Spoke topology.  </p>"},{"location":"task1/#step-1-review-existing-policy","title":"Step 1: Review existing policy","text":"<p>Once you have the RDP session to the remote workstation, open Chrome browser icon on the desktop.  </p> <ul> <li> <p>Enter https://vmanage.dcloud.cisco.com:8443 in browser address bar; login with username admin, password C1sco12345.  </p> </li> <li> <p>Click SD-WAN Manager navagination bar, go to Configuration &gt; Policies. Locate pre-configured policy REGIONAL_HUB_AND_SPOKE_BGP_CORE_POLICY, click the ... on the right and select Preview.  </p> </li> </ul> <p></p> <ul> <li>ThisREGIONAL_HUB_AND_SPOKE_BGP_CORE_POLICY policy adjusts the Control Plane to intercommunicate all sites within the West region in a full-mesh fashion but without direct connectivity to the East region, by denying TLOCs and using TLOC re-writes. For this we rely on the West Hub (Site 201) connectivity towards the East Hub (Site 202) through the BGP Core network using Service side VPN.  </li> </ul> <p> Note: Refer to the Regional Hub &amp; Spoke with BGP Core topology diagram for further analysis. </p> <p>As you can see it is a complex policy even for a very small environment with same two transports used everywhere.  </p> <pre><code>viptela-policy:policy\n control-policy EAST-BRANCHES-SITES-CP\n    sequence 1\n     match tloc\n      site-list EAST-ALL-SITES\n     !\n     action accept\n     !\n    !\n    sequence 11\n     match route\n      site-list EAST-ALL-SITES\n      prefix-list _AnyIpv4PrefixList\n     !\n     action accept\n     !\n    !\n    sequence 21\n     match route\n      site-list WEST-ALL-SITES\n      prefix-list _AnyIpv4PrefixList\n     !\n     action accept\n      set\n       tloc-list EAST-HUB-TLOCS\n      !\n     !\n    !\n  default-action reject\n !\n control-policy BGP-CORE-EAST-HUB-CP\n    sequence 1\n     match tloc\n      site-list EAST-ALL-SITES\n     !\n     action accept\n     !\n    !\n    sequence 11\n     match route\n      site-list EAST-ALL-SITES\n      prefix-list _AnyIpv4PrefixList\n     !\n     action accept\n     !\n    !\n  default-action reject\n !\n control-policy BGP-CORE-WEST-HUB-CP\n    sequence 1\n     match tloc\n      site-list WEST-ALL-SITES\n     !\n     action accept\n     !\n    !\n    sequence 11\n     match route\n      site-list WEST-ALL-SITES\n      prefix-list _AnyIpv4PrefixList\n     !\n     action accept\n     !\n    !\n  default-action reject\n !\n control-policy WEST-BRANCHES-SITES-CP\n    sequence 1\n     match tloc\n      site-list WEST-ALL-SITES\n     !\n     action accept\n     !\n    !\n    sequence 11\n     match route\n      site-list WEST-ALL-SITES\n      prefix-list _AnyIpv4PrefixList\n     !\n     action accept\n     !\n    !\n    sequence 21\n     match route\n      site-list EAST-ALL-SITES\n      prefix-list _AnyIpv4PrefixList\n     !\n     action accept\n      set\n       tloc-list WEST-HUB-TLOCS\n      !\n     !\n    !\n  default-action reject\n !\n lists\n  site-list EAST-ALL-SITES\n   site-id 202 \n   site-id 6000-7000 \n  !\n  site-list EAST-BRANCHES\n   site-id 6000 \n   site-id 7000 \n  !\n  site-list EAST-HUB\n   site-id 202 \n  !\n  site-list WEST-ALL-SITES\n   site-id 201 \n   site-id 1010-1020 \n   site-id 3000-5000 \n  !\n  site-list WEST-BRANCHES\n   site-id 1010-1020 \n   site-id 3000 \n   site-id 4000 \n   site-id 5000 \n  !\n  site-list WEST-HUB\n   site-id 201 \n  !\n  tloc-list EAST-HUB-TLOCS\n   tloc 1.1.202.1 color public-internet encap ipsec \n   tloc 1.1.202.1 color mpls encap ipsec \n   tloc 1.1.202.2 color public-internet encap ipsec \n   tloc 1.1.202.2 color mpls encap ipsec \n  !\n  tloc-list WEST-HUB-TLOCS\n   tloc 1.1.201.1 color public-internet encap ipsec \n   tloc 1.1.201.1 color mpls encap ipsec \n   tloc 1.1.201.2 color public-internet encap ipsec \n   tloc 1.1.201.2 color mpls encap ipsec \n  !\n  prefix-list _AnyIpv4PrefixList\n   ip-prefix 0.0.0.0/0 le 32 \n  !\n !\n!\napply-policy\n site-list WEST-BRANCHES\n  control-policy WEST-BRANCHES-SITES-CP out\n !\n site-list EAST-BRANCHES\n  control-policy EAST-BRANCHES-SITES-CP out\n !\n site-list EAST-HUB\n  control-policy BGP-CORE-EAST-HUB-CP out\n !\n site-list WEST-HUB\n  control-policy BGP-CORE-WEST-HUB-CP out\n !\n!\n</code></pre>"},{"location":"task1/#step-2-review-bfd-tunnels","title":"Step 2: Review BFD Tunnels","text":"<p>Next, you'll examine the BFD tunnels from the spoke sites. You can either utilize the Manager Real Time UI option to confirm TLOCs and BFD sessions, or opt to SSH into the WAN Edges and execute command lines via an SSH terminal. For SSH access, you can leverage mRemoteNG on your desktop.  </p> <ul> <li>Navigate to the SD-WAN Manager navagination bar, then proceed to Monitor &gt; Device. Locate EDGE-BRANCH-3-01, click on the device and choose Real Time as show in the screenshot below.  </li> </ul> <p>In the Device Options field, enter OMP Received TLOCS. As you can see, there are no TLOCs now to any site in the East region and therefore no tunnels to them.  </p> <p> </p> <p>We can confirm this by looking for BFD Sessions in the Device Options field. We don\u2019t see East TLOC\u2019s IPs like 1.1.60.1, 1.1.70.1, 1.1.202.1 or 1.1.202.2 nor BFD tunnels against their Site IDs 202,6000 and 7000 </p> <p> </p>"},{"location":"task1/#step-3-review-ip-route","title":"Step 3: Review IP Route","text":"<p>Next, you'll examine the route tables from the spoke sites.  </p> <p>In the Device Options field, enter IP route. As you can see, even though it doesn't have tunnels towards the East sites, it has prefixes for such sites but pointing to the West Hubs (Site 201) TLOCs IPs instead of the originators.  </p> <p> </p>"},{"location":"task1/#step-4-review-path-between-spoke-sites","title":"Step 4: Review Path between spoke sites","text":"<p>Next, you'll run traceroute and ping to test reachability of ubuntu hosts between different branch sites.  </p> <p>Click mRemoteNG  on your desktop, select Site-3000-VPN-10-Ubun and open RDP session to the host with username viptela, passwordC1sco12345. Run ping and traceroute to Ubuntu host in Site 6000 with IP 10.60.1.101.   </p> <p> </p> <p>From the trace above, even though the site 3000 and site 6000 have the Public-Internet transport in common, they do not communicate directly to each other because the current active Control Policy, going through the Hubs and therefore the BGP Core squared with red color in the trace.</p> <p>Next, let's check the route table on West hub site BR-WEST-1. Go to the Manage GUI and then go to Monitor &gt; Devices &gt; BR-WEST-1 (1.1.201.1) &gt; Real Time and look up for IP route with the VPN 10 filter.  </p> <p> </p> <p>As you see from the route table, the prefixes from East Regions are learned from BGP core. </p>"},{"location":"task2/","title":"Task 2 - Migrate to MRF","text":"<p>In this task, you will perform the following prerequisites before migrating MRF.  </p> <ul> <li>Enable MRF  </li> <li>Creat regions  </li> <li>Provision Controllers for regions  </li> </ul>"},{"location":"task2/#step-1-enable-mrf","title":"Step 1: Enable MRF","text":"<p>In this step, you will enable MRF on vManage. Note: The MRF feature has been pre-enabled for this lab. This section is for your review of the workflow </p> <ul> <li>Click SD-WAN Manager navagination bar, go to Administration &gt; Settings. and confirm that the Multi-Region Fabric setting is enabled (By default is disabled).  </li> </ul> <p></p>"},{"location":"task2/#step-2-create-regions","title":"Step 2: Create Regions","text":"<p>After enabling MRF, the subsequent step involves creating the regions. For this lab, we'll establish two regions: EAST-REGION and WEST-REGION. Upon creation, the system automatically assigns a Region ID. In this setup, WEST-REGION has been designated with Region ID 1, and EAST-REGION has been assigned Region ID 2.  </p> <p> Note: The Regioins has been pre-enabled for this lab. This section is for your review of the workflow </p> <ul> <li>Go to Configuration &gt; Network Hierarchy and you should see that the EAST-REGION and WEST-REGION have been pre-configured.  </li> </ul> <p></p> <p>### Step 3: Provision Controllers for Regions </p> <p>In </p>"},{"location":"topology/","title":"Lab Topology","text":"<p>Network topology used in this lab are shown in below picture:  </p> <ul> <li>Regional Hub &amp; Spoke with BGP core  </li> </ul> <p> </p> <ul> <li>Multi-Region (MRF) SD-WAN Fanric  </li> </ul> <p> </p>"}]}